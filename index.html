<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Cinematic Meteor Shower â€” Straight & Fast</title>
<style>
  html,body{margin:0;height:100%;background:#000}
  canvas{display:block;width:100vw;height:100vh}
  .ui{position:fixed;top:16px;left:16px;z-index:10;display:flex;gap:8px;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
  button{padding:8px 12px;border:1px solid #444;background:#0b0b0b;color:#eee;border-radius:10px;cursor:pointer}
  button:hover{background:#131313}
</style>
</head>
<body>
<div class="ui">
  <button id="startBtn">Start</button>
  <button id="stopBtn">Stop</button>
</div>
<canvas id="c"></canvas>

<script>
(()=> {
  const canvas = document.getElementById('c');
  const ctx = canvas.getContext('2d', { alpha:false });
  // Offscreen glow buffer for bloom
  const glow = document.createElement('canvas');
  const gtx  = glow.getContext('2d', { alpha:true });

  let dpr = 1, W = 0, H = 0, groundY = 0;
  let running = false, raf = null, spawnTimer = null;

  const stars=[], meteors=[], sparks=[], smoke=[], shock=[], flashes=[], craters=[];
  let shake = 0;

  const r=(a,b)=>Math.random()*(b-a)+a;
  const ri=(a,b)=>Math.floor(r(a,b));
  const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));

  function resize(){
    dpr = Math.max(1, Math.min(2, devicePixelRatio||1));
    W = Math.floor(innerWidth*dpr);
    H = Math.floor(innerHeight*dpr);
    canvas.width=W; canvas.height=H;
    canvas.style.width=innerWidth+'px';
    canvas.style.height=innerHeight+'px';

    glow.width = Math.max(1, Math.floor(W*0.5));
    glow.height= Math.max(1, Math.floor(H*0.5));
    gtx.clearRect(0,0,glow.width,glow.height);

    groundY = H - 90*dpr;
    initStars(); drawBackground(0);
  }

  function initStars(){
    stars.length=0;
    const n=Math.floor((W*H)/24000);
    for(let i=0;i<n;i++){
      stars.push({x:Math.random()*W,y:Math.random()*H*0.75,r:r(0.6,1.6)*dpr,s:r(0.001,0.006),p:r(0,Math.PI*2)});
    }
  }

  function drawBackground(t){
    const g=ctx.createLinearGradient(0,0,0,H);
    g.addColorStop(0,'#03060e'); g.addColorStop(0.45,'#071124'); g.addColorStop(1,'#0a1733');
    ctx.fillStyle=g; ctx.fillRect(0,0,W,H);

    const neb=ctx.createRadialGradient(W*0.7,H*0.25,0,W*0.7,H*0.25,Math.max(W,H)*0.6);
    neb.addColorStop(0,'rgba(60,100,200,0.06)'); neb.addColorStop(1,'rgba(0,0,0,0)');
    ctx.fillStyle=neb; ctx.fillRect(0,0,W,H);

    ctx.save(); ctx.globalCompositeOperation='lighter';
    for(const s of stars){
      const a=0.5+0.5*Math.sin(t*s.s+s.p);
      ctx.globalAlpha=0.35+0.65*a;
      ctx.beginPath(); ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
      ctx.fillStyle='#cfe1ff'; ctx.fill();
    }
    ctx.restore();

    const hg=ctx.createLinearGradient(0,groundY-240*dpr,0,groundY+420*dpr);
    hg.addColorStop(0,'rgba(255,160,60,0.06)');
    hg.addColorStop(1,'rgba(255,120,30,0)');
    ctx.fillStyle=hg; ctx.fillRect(0,groundY-260*dpr,W,600*dpr);

    ctx.fillStyle='#06080f'; ctx.fillRect(0,groundY,W,H-groundY);

    const vig=ctx.createRadialGradient(W*0.5,H*0.5,Math.min(W,H)*0.2,W*0.5,H*0.5,Math.max(W,H)*0.65);
    vig.addColorStop(0,'rgba(0,0,0,0)'); vig.addColorStop(1,'rgba(0,0,0,0.45)');
    ctx.fillStyle=vig; ctx.fillRect(0,0,W,H);
  }

  // Straight-line meteors with per-meteor speed
  function spawnMeteor(){
    const edge = Math.random()<0.7 ? 'top' : 'left';
    const sx = edge==='top' ? r(-0.05*W, 0.75*W) : -0.05*W;
    const sy = edge==='top' ? r(-0.02*H, 0.15*H) : r(0.05*H, 0.45*H);
    const ang = r(0.24*Math.PI, 0.34*Math.PI); // fixed downward angle
    const speed = r(7, 10.0) * dpr;            // faster, varied
    const thick = r(2.0,3.6)*dpr;
    const len   = r(200,340)*dpr;

    meteors.push({
      x:sx,y:sy,
      vx:Math.cos(ang)*speed, vy:Math.sin(ang)*speed, // constant; no gravity, no wobble
      thick,len,
      hue: ri(22,48),
      born: performance.now()
    });
  }

  function explode(x,y,h){
    flashes.push({x,y,born:performance.now(),life:ri(140,220)});
    shock.push({x,y,r:1,vr:r(1.0,1.7)*dpr,born:performance.now(),life:ri(650,900)});

    const n=ri(70,120);
    for(let i=0;i<n;i++){
      const a=r(0,Math.PI*2), sp=r(0.7,3.8)*dpr;
      sparks.push({x,y,vx:Math.cos(a)*sp,vy:Math.sin(a)*sp,g:r(0.002,0.006)*dpr,
        r:r(0.6,1.8)*dpr,hue:h+ri(-12,12),born:performance.now(),life:ri(600,1300)});
    }
    const m=ri(90,150);
    for(let i=0;i<m;i++){
      const a=r(-Math.PI,0), sp=r(0.2,1.1)*dpr;
      smoke.push({x,y,vx:Math.cos(a)*sp,vy:Math.sin(a)*sp- r(0.1,0.4)*dpr,
        drag:r(0.96,0.985),r:r(3,8)*dpr,born:performance.now(),life:ri(1200,2200)});
    }
    craters.push({x,y:groundY,r:0,target:r(16,34)*dpr});
    shake=Math.min(28*dpr,shake+10*dpr);
  }

  function drawMeteor(m, now, dt){
    // Straight integration. No gravity, no zig-zag.
    m.x += m.vx*(dt*1000/16);
    m.y += m.vy*(dt*1000/16);

    const sp = Math.hypot(m.vx,m.vy)||1;
    const tx = m.x - (m.vx * m.len)/sp;
    const ty = m.y - (m.vy * m.len)/sp;

    // Main pass
    ctx.save();
    ctx.globalCompositeOperation='lighter';
    const grad = ctx.createLinearGradient(tx,ty,m.x,m.y);
    grad.addColorStop(0, `hsla(${m.hue-8},100%,48%,0)`);
    grad.addColorStop(0.65, `hsla(${m.hue+8},100%,58%,0.65)`);
    grad.addColorStop(1, `hsla(${m.hue+18},100%,70%,1)`);
    ctx.strokeStyle=grad; ctx.lineWidth=m.thick; ctx.lineCap='round';
    ctx.beginPath(); ctx.moveTo(tx,ty); ctx.lineTo(m.x,m.y); ctx.stroke();

    // Core
    ctx.globalAlpha=0.95;
    ctx.beginPath(); ctx.arc(m.x,m.y,m.thick*2.5,0,Math.PI*2);
    ctx.fillStyle=`hsla(${m.hue+16},100%,66%,0.95)`; ctx.fill();
    ctx.restore();

    // Glow buffer
    const gx=m.x*0.5, gy=m.y*0.5, gtxTx=tx*0.5, gtxTy=ty*0.5;
    gtx.save(); gtx.globalCompositeOperation='lighter'; gtx.lineCap='round';
    const ggrad=gtx.createLinearGradient(gtxTx,gtxTy,gx,gy);
    ggrad.addColorStop(0,'rgba(255,120,40,0)');
    ggrad.addColorStop(1,'rgba(255,200,120,0.9)');
    gtx.strokeStyle=ggrad; gtx.lineWidth=Math.max(1,m.thick*0.5);
    gtx.beginPath(); gtx.moveTo(gtxTx,gtxTy); gtx.lineTo(gx,gy); gtx.stroke();
    gtx.beginPath(); gtx.arc(gx,gy,m.thick*1.4,0,Math.PI*2);
    gtx.fillStyle='rgba(255,220,160,0.9)'; gtx.fill();
    gtx.restore();

    // Ember peel
    if (Math.random()<0.28){
      sparks.push({
        x:m.x,y:m.y,
        vx:-m.vx*r(0.03,0.1), vy:-m.vy*r(0.03,0.1),
        g:r(0.002,0.005)*dpr, r:r(0.6,1.4)*dpr,
        hue:m.hue+ri(-10,10), born:now, life:ri(300,700)
      });
    }

    // Impact
    if (m.y>=groundY){
      explode(m.x,groundY,m.hue);
      meteors.splice(meteors.indexOf(m),1);
    }
  }

  function drawSparks(now,dt){
    ctx.save(); ctx.globalCompositeOperation='lighter';
    for(let i=sparks.length-1;i>=0;i--){
      const p=sparks[i]; const t=(now-p.born)/p.life;
      if(t>=1){ sparks.splice(i,1); continue; }
      p.vy+=p.g*(dt*1000/16);
      p.x+=p.vx*(dt*1000/16);
      p.y+=p.vy*(dt*1000/16);
      ctx.globalAlpha=1-t;
      ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
      ctx.fillStyle=`hsla(${p.hue},100%,64%,1)`; ctx.fill();

      // Glow buffer
      gtx.save(); gtx.globalCompositeOperation='lighter';
      gtx.globalAlpha=(1-t)*0.9;
      gtx.beginPath(); gtx.arc(p.x*0.5,p.y*0.5,Math.max(0.8,p.r*0.7),0,Math.PI*2);
      gtx.fillStyle='rgba(255,200,140,0.9)'; gtx.fill();
      gtx.restore();
    }
    ctx.restore();
  }

  function drawSmoke(now,dt){
    ctx.save();
    for(let i=smoke.length-1;i>=0;i--){
      const s=smoke[i]; const t=(now-s.born)/s.life;
      if(t>=1){ smoke.splice(i,1); continue; }
      s.vx*=s.drag; s.vy*=s.drag;
      s.x+=s.vx*(dt*1000/16);
      s.y+=s.vy*(dt*1000/16);
      ctx.globalAlpha=0.16*(1-t);
      ctx.fillStyle='#4d576a';
      ctx.beginPath(); ctx.arc(s.x,s.y,s.r*(1+t*1.8),0,Math.PI*2); ctx.fill();
    }
    ctx.restore();
  }

  function drawShock(now){
    ctx.save(); ctx.globalCompositeOperation='lighter';
    for(let i=shock.length-1;i>=0;i--){
      const s=shock[i]; const t=(now-s.born)/s.life;
      if(t>=1){ shock.splice(i,1); continue; }
      s.r += s.vr*16;
      const a=1-t;
      ctx.globalAlpha=a;
      ctx.strokeStyle='rgba(255,230,180,0.9)'; ctx.lineWidth=2*dpr;
      ctx.beginPath(); ctx.arc(s.x,s.y,s.r,0,Math.PI*2); ctx.stroke();

      const rg=ctx.createRadialGradient(s.x,s.y,s.r*0.6,s.x,s.y,s.r*1.1);
      rg.addColorStop(0,`rgba(255,170,90,${0.16*a})`);
      rg.addColorStop(1,'rgba(255,120,40,0)');
      ctx.fillStyle=rg; ctx.beginPath(); ctx.arc(s.x,s.y,s.r,0,Math.PI*2); ctx.fill();
    }
    ctx.restore();
  }

  function drawFlashes(now){
    if(!flashes.length) return;
    ctx.save();
    for(let i=flashes.length-1;i>=0;i--){
      const f=flashes[i]; const t=(now-f.born)/f.life;
      if(t>=1){ flashes.splice(i,1); continue; }
      const a=1-t;
      const g=ctx.createRadialGradient(f.x,f.y,0,f.x,f.y,Math.max(W,H)*0.6);
      g.addColorStop(0,`rgba(255,240,210,${a*0.9})`);
      g.addColorStop(1,'rgba(255,160,60,0)');
      ctx.globalCompositeOperation='screen';
      ctx.fillStyle=g; ctx.fillRect(0,0,W,H);
    }
    ctx.restore();
  }

  function drawCraters(){
    for(const c of craters){
      c.r=Math.min(c.target,c.r+1.5*dpr);
      ctx.fillStyle='#0b0e17';
      ctx.beginPath(); ctx.ellipse(c.x,c.y+4*dpr,c.r*1.7,c.r*0.6,0,0,Math.PI*2); ctx.fill();

      const g=ctx.createRadialGradient(c.x,c.y,c.r*0.4,c.x,c.y,c.r*1.3);
      g.addColorStop(0,'rgba(255,150,70,0.10)');
      g.addColorStop(1,'rgba(255,120,40,0)');
      ctx.fillStyle=g; ctx.beginPath(); ctx.arc(c.x,c.y,c.r*1.2,0,Math.PI*2); ctx.fill();
    }
  }

  function persistenceFade(){
    ctx.fillStyle='rgba(0,0,0,0.18)'; ctx.fillRect(0,0,W,H);
    gtx.fillStyle='rgba(0,0,0,0.22)'; gtx.fillRect(0,0,glow.width,glow.height);
  }

  function drawBloom(){
    ctx.save(); ctx.globalCompositeOperation='lighter';
    ctx.filter='blur(12px)'; ctx.globalAlpha=0.55;
    ctx.drawImage(glow,0,0,glow.width,glow.height,0,0,W,H);
    ctx.filter='blur(4px)'; ctx.globalAlpha=0.75;
    ctx.drawImage(glow,0,0,glow.width,glow.height,0,0,W,H);
    ctx.filter='none'; ctx.globalAlpha=1; ctx.restore();
  }

  function spawnLoop(){
    if(!running) return;
    const burst=Math.random()<0.3;
    const count=burst?ri(3,5):ri(1,2);
    for(let i=0;i<count;i++) spawnMeteor();
    spawnTimer=setTimeout(spawnLoop, burst?ri(220,480):ri(550,1100));
  }

  function start(){
    if(running) return;
    running=true; loop.last=undefined;
    spawnLoop(); raf=requestAnimationFrame(loop);
  }
  function stop(){
    running=false;
    if(raf) cancelAnimationFrame(raf), raf=null;
    if(spawnTimer) clearTimeout(spawnTimer), spawnTimer=null;
    meteors.length=sparks.length=smoke.length=shock.length=flashes.length=craters.length=0;
    gtx.clearRect(0,0,glow.width,glow.height);
    shake=0; drawBackground(performance.now());
  }

  function loop(now){
    if(!running) return;
    if(!loop.last) loop.last=now;
    const dt=Math.min(33, now-loop.last)/1000; loop.last=now;

    persistenceFade();
    drawBackground(now);

    ctx.save();
    const sx=(Math.random()*2-1)*shake, sy=(Math.random()*2-1)*shake;
    ctx.translate(sx,sy); shake*=0.93;

    for(let i=meteors.length-1;i>=0;i--) drawMeteor(meteors[i], now, dt);
    drawSparks(now,dt); drawSmoke(now,dt); drawShock(now); drawCraters();
    ctx.restore();

    drawBloom();
    drawFlashes(now);

    raf=requestAnimationFrame(loop);
  }

  window.addEventListener('resize', resize);
  resize(); drawBackground(performance.now());
  document.getElementById('startBtn').addEventListener('click', start);
  document.getElementById('stopBtn').addEventListener('click', stop);
  window.addEventListener('keydown', e=>{ if(e.code==='Space'){ e.preventDefault(); running?stop():start(); }});
})();
</script>
</body>
</html>
